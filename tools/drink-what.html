<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6331195744309280"
     crossorigin="anonymous"></script>
  <title>éš¨æ©Ÿå–ä»€éº¼ï½œRoy Toolbox</title>
  <meta name="description" content="éš¨æ©Ÿå–ä»€éº¼ï¼šå¹«ä½ æŠ½å‡ºä»Šæ—¥é£²æ–™å¡ï¼Œå«å‹•ç•«ã€é è¨­é£²æ–™æ¸…å–®ã€é¿å…é‡è¤‡æŠ½ä¸­åŠŸèƒ½ã€‚å…è²»å…å®‰è£ï¼Œç·šä¸Šå¯ç”¨ã€‚">

  <link rel="stylesheet" href="/global.css">
  <link rel="stylesheet" href="/css/loyui.css">

  <script src="/js/loadHeader.js"></script>

  <style>
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 16px 60px;
      font-family: "Noto Sans TC", sans-serif;
    }

    /* æ¡Œæ©Ÿï¼šå·¦å³å…©æ¬„ */
    .layout {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 18px;
    }

    /* æ‰‹æ©Ÿ â†’ ä¸Šä¸‹æ’åˆ— */
    @media (max-width: 768px) {
      .layout {
        display: block !important;
      }
      .loy-card {
        margin-bottom: 16px;
        width: 100%;
      }

      .btn-row {
        display: flex;
        flex-direction: column;
        width: 100%;
        gap: 10px;
        margin-top: 8px;
      }

      .btn-row button {
        width: 100%;
      }

      .draw-card {
        max-width: 100%;
        min-height: 140px;
        padding: 18px;
      }
    }

    .loy-textarea {
      width: 100%;
      min-height: 240px;
      resize: vertical;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      font-size: 14px;
      line-height: 1.6;
      box-sizing: border-box;
      transition: 0.2s;
    }
    .loy-textarea:focus {
      outline: none;
      border-color: var(--loy-blue);
      box-shadow: 0 0 0 3px rgba(106,167,255,0.35);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #777;
      flex-wrap: wrap;
    }

    .count-text {
      font-size: 13px;
      color: #666;
    }

    .draw-card-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .draw-card {
      width: 100%;
      max-width: 360px;
      min-height: 150px;
      border-radius: 16px;
      padding: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .draw-tag {
      position: absolute;
      top: 10px;
      right: 14px;
      font-size: 11px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.06);
      border-radius: 999px;
      color: #555;
    }

    .draw-emoji {
      font-size: 26px;
      margin-bottom: 4px;
    }

    .draw-main {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 1px;
    }

    .draw-sub {
      font-size: 12px;
      color: #777;
    }

    .draw-footer {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
      text-align: center;
    }

    .draw-card.animate {
      animation: loyCardPop 0.6s ease-out;
    }

    @keyframes loyCardPop {
      0%   { transform: scale(0.75) rotate(-4deg); opacity: 0; }
      45%  { transform: scale(1.04) rotate(1deg); opacity: 1; }
      100% { transform: scale(1) rotate(0); }
    }

    #errorMsg {
      margin-top: 4px;
      font-size: 13px;
      color: #e02424;
      display: none;
    }

    #hintMsg {
      margin-top: 6px;
      font-size: 13px;
      color: var(--loy-blue);
      display: none;
      opacity: 0;
      transition: opacity .4s;
    }
  </style>
</head>

<body>

  <div id="header"></div>
  <script>
    loadHeader("ç”Ÿæ´»å·¥å…·", "éš¨æ©Ÿå–ä»€éº¼");
  </script>

  <main>
    <h1>éš¨æ©Ÿå–ä»€éº¼</h1>
    <p>ä¸çŸ¥é“å–ä»€éº¼çš„æ™‚å€™ï¼Œå°±è®“å°æ´›ä¼Šå¹«ä½ æŠ½å‡ºä¸€å¼µã€Œä»Šæ—¥é£²æ–™å¡ã€å§ï¼</p>

    <div class="layout">

      <!-- å·¦å´ï¼šæ¸…å–® -->
      <section class="loy-card">
        <div class="panel-header">
          <div id="itemCount" class="count-text">ç›®å‰ 0 å€‹é¸é …</div>
          <button id="btnClearList" class="tool-btn secondary">æ¸…ç©ºæ¸…å–®</button>
        </div>

        <textarea id="itemInput" class="loy-textarea"></textarea>

        <label style="font-size:13px;">
          <input type="checkbox" id="chkNoRepeat" checked>
          é¿å…é€£çºŒæŠ½åˆ°ç›¸åŒé¸é …
        </label>

        <div id="errorMsg"></div>
        <div id="hintMsg">é è¨­é£²æ–™å·²è¼‰å…¥</div>
      </section>

      <!-- å³å´ï¼šæŠ½å¡ -->
      <section class="loy-card">
        <div class="panel-header">
          <span>æŠ½å¡çµæœ</span>
          <span style="font-size:12px;color:#aaa;">æŒ‰ã€Œé–‹å§‹æŠ½ã€æˆ–æŒ‰ Space</span>
        </div>

        <div class="draw-card-wrapper">
          <div class="draw-card" id="drawCard">
            <div class="draw-tag">ä»Šæ—¥é£²æ–™</div>
            <div id="drawEmoji" class="draw-emoji">ğŸ¥¤</div>
            <div id="drawMain" class="draw-main">å°šæœªæŠ½å¡</div>
            <div id="drawSub" class="draw-sub">æº–å‚™å¥½å¾ŒæŒ‰ä¸‹é–‹å§‹æŠ½å§ï¼</div>
          </div>

          <!-- ä¿®å¾©å¾Œçš„æŒ‰éˆ•å€ -->
          <div class="btn-row">
            <button id="btnDraw" class="tool-btn">é–‹å§‹æŠ½</button>
            <button id="btnReDraw" class="tool-btn secondary" disabled>å†æŠ½ä¸€æ¬¡</button>
          </div>

          <div id="drawFooter" class="draw-footer">å°æç¤ºï¼šé£²æ–™åç¨±èˆ‡åœ–ç‰‡ç„¡é—œå–”ï¼</div>
        </div>
      </section>

    </div>
  </main>

  <script>
    /* --------------------------
       é è¨­é£²æ–™æ¸…å–®
    --------------------------- */
    const defaultItems = [
      "çç å¥¶èŒ¶","ç´…èŒ¶","ç¶ èŒ¶","é’èŒ¶","çƒé¾èŒ¶",
      "å››å­£æ˜¥","ç´…èŒ¶æ‹¿éµ","ç¶ èŒ¶æ‹¿éµ","å¥¶è“‹ç´…èŒ¶","å¥¶è“‹ç¶ èŒ¶",
      "é»‘ç³–çå¥¶","æŠ¹èŒ¶ç‰›å¥¶","æ³°å¼å¥¶èŒ¶","å¯å¯","é˜¿è¯ç”°",
      "å¤šå¤šç¶ ","å¤šå¤šç´…","è˜‹æœç¶ ","è‘¡è„æŸšç¶ ","æŸ³æ©™ç¶ ",
      "å†¬ç“œèŒ¶","å†¬ç“œæª¸æª¬","èœ‚èœœæª¸æª¬","èœ‚èœœç¶ èŒ¶","æ°´æœèŒ¶",
      "å„ªé…ªä¹³","é¤Šæ¨‚å¤š","å†°æ²™","èŠ’æœå†°æ²™","è‰è“å†°æ²™",
      "ç¾å¼å’–å•¡","æ‹¿éµ","å¡å¸ƒå¥‡è«¾","ç„¦ç³–ç‘ªå¥‡æœµ","æ‰‹æ²–å’–å•¡",
      "å¯æ¨‚","é›ªç¢§","è˜‹æœè¥¿æ‰“","æ°£æ³¡æ°´","ä¹³é…¸é£²æ–™"
    ];

    /* å–å¾—å…ƒç´  */
    const itemInput = document.getElementById("itemInput");
    const itemCount = document.getElementById("itemCount");
    const errorMsg = document.getElementById("errorMsg");
    const hintMsg = document.getElementById("hintMsg");
    const chkNoRepeat = document.getElementById("chkNoRepeat");

    const btnClearList = document.getElementById("btnClearList");
    const btnDraw = document.getElementById("btnDraw");
    const btnReDraw = document.getElementById("btnReDraw");

    const drawCard = document.getElementById("drawCard");
    const drawEmoji = document.getElementById("drawEmoji");
    const drawMain = document.getElementById("drawMain");
    const drawSub = document.getElementById("drawSub");

    let lastChoice = null;
    let flashTimer = null;

    /* --------------------------
       åˆå§‹åŒ–é è¨­é£²æ–™
    --------------------------- */
    function loadDefault() {
      itemInput.value = defaultItems.join("\n");
      updateCount();
      showHint("é è¨­é£²æ–™å·²è¼‰å…¥");
    }

    function getItems() {
      return itemInput.value
        .split(/\r?\n/)
        .map(v => v.trim())
        .filter(v => v.length > 0);
    }

    function updateCount() {
      itemCount.textContent = `ç›®å‰ ${getItems().length} å€‹é¸é …`;
    }

    function showHint(msg) {
      hintMsg.textContent = msg;
      hintMsg.style.display = "block";
      hintMsg.style.opacity = "1";

      setTimeout(() => {
        hintMsg.style.opacity = "0";
        setTimeout(() => hintMsg.style.display = "none", 400);
      }, 1200);
    }

    function showError(msg) {
      if (!msg) {
        errorMsg.style.display = "none";
        return;
      }
      errorMsg.textContent = msg;
      errorMsg.style.display = "block";
    }

    /* --------------------------
       æŠ½å¡è·‘é¦¬ç‡ˆå‹•ç•«
    --------------------------- */
    function startFlash(items, duration = 800) {
      return new Promise(resolve => {
        let idx = 0;

        flashTimer = setInterval(() => {
          drawMain.textContent = items[idx];
          drawEmoji.textContent = "âœ¨";
          idx = (idx + 1) % items.length;
        }, 70);

        setTimeout(() => {
          clearInterval(flashTimer);
          resolve();
        }, duration);
      });
    }

    /* --------------------------
       æŠ½ä¸€å€‹é£²æ–™
    --------------------------- */
    function pickOne() {
      const items = getItems();
      if (!items.length) return null;

      let choice = items[Math.floor(Math.random() * items.length)];

      if (chkNoRepeat.checked && items.length > 1) {
        let safe = 0;
        while (choice === lastChoice && safe < 8) {
          choice = items[Math.floor(Math.random() * items.length)];
          safe++;
        }
      }
      lastChoice = choice;
      return choice;
    }

    /* --------------------------
       æ›´æ–°çµæœå¡ç‰‡
    --------------------------- */
    function updateResult(choice) {
      if (!choice) return;

      const emojis = ["ğŸ¥¤","ğŸ§‹","ğŸ¹","ğŸ¸","â˜•","ğŸ«–","ğŸ§ƒ","ğŸ¥›"];
      drawEmoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      drawMain.textContent = choice;
      drawSub.textContent = "å°±æ±ºå®šæ˜¯å®ƒäº†ï¼";

      drawCard.classList.remove("animate");
      void drawCard.offsetWidth;
      drawCard.classList.add("animate");

      btnReDraw.disabled = false;
    }

    /* --------------------------
       æŒ‰éˆ•äº‹ä»¶
    --------------------------- */
    btnClearList.onclick = () => {
      itemInput.value = "";
      updateCount();
      showError("");
      btnReDraw.disabled = true;
      drawMain.textContent = "å°šæœªæŠ½å¡";
      drawSub.textContent = "è«‹è¼¸å…¥æ¸…å–®å¾Œå†æŠ½å–ï½";
      drawEmoji.textContent = "ğŸ¥¤";
    };

    btnDraw.onclick = async () => {
      const items = getItems();
      showError("");

      if (items.length === 0) {
        showError("æ¸…å–®æ˜¯ç©ºçš„ï¼Œè«‹å…ˆè¼¸å…¥æˆ–è¼‰å…¥é è¨­é£²æ–™ã€‚");
        return;
      }

      await startFlash(items, 900);
      updateResult(pickOne());
    };

    btnReDraw.onclick = async () => {
      const items = getItems();
      if (items.length === 0) return;

      await startFlash(items, 900);
      updateResult(pickOne());
    };

    /* Space å¿«é€ŸæŠ½å¡ */
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space" && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName)) {
        e.preventDefault();
        btnDraw.click();
      }
    });

    itemInput.addEventListener("input", () => {
      updateCount();
      showError("");
    });

    loadDefault();

  </script>


  <div id="global-buttons"></div>
  <script src="/js/global.js"></script>
  <script src="/js/loyui.js"></script>

</body>
</html>
