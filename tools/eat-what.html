<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6331195744309280"
     crossorigin="anonymous"></script>

  <title>éš¨æ©Ÿåƒä»€éº¼ï½œRoy Dreambox</title>
  <meta name="description" content="éš¨æ©Ÿåƒä»€éº¼ï¼šæŠ½å‡ºä»Šæ—¥é¤é»å¡ï¼Œæ­é…ç‰¹è£½å‹•ç•«èˆ‡é è¨­æ¸…å–®ï¼Œé¿å…é‡è¤‡æŠ½ä¸­ï¼Œé©åˆé¸æ“‡å›°é›£ç—‡ä½¿ç”¨ã€‚å…è²»å…å®‰è£ï¼Œç·šä¸Šå¯ç”¨ã€‚">

  <link rel="stylesheet" href="/global.css">
  <link rel="stylesheet" href="/css/loyui.css">
  <script src="/js/loadHeader.js"></script>

  <style>
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 20px 16px 60px;
      font-family: "Noto Sans TC", sans-serif;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 18px;
    }
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }

    .loy-textarea {
      width: 100%;
      min-height: 240px;
      resize: vertical;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card-bg);
      font-size: 14px;
      line-height: 1.6;
      box-sizing: border-box;
      transition: 0.2s;
    }
    .loy-textarea:focus {
      outline: none;
      border-color: var(--loy-blue);
      box-shadow: 0 0 0 3px rgba(106,167,255,0.35);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
      color: #777;
      flex-wrap: wrap;
    }

    .count-text {
      font-size: 13px;
      color: #666;
    }

    .draw-card-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .draw-card {
      width: 100%;
      max-width: 360px;
      min-height: 150px;
      border-radius: 16px;
      padding: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      box-shadow: 0 3px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .draw-tag {
      position: absolute;
      top: 10px;
      right: 14px;
      font-size: 11px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.06);
      border-radius: 999px;
      color: #555;
    }

    .draw-emoji {
      font-size: 26px;
      margin-bottom: 4px;
    }

    .draw-main {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: 1px;
    }

    .draw-sub {
      font-size: 12px;
      color: #777;
    }

    .draw-footer {
      font-size: 12px;
      color: #888;
      margin-top: 4px;
      text-align: center;
    }

    .draw-card.animate {
      animation: loyCardPop 0.6s ease-out;
    }

    @keyframes loyCardPop {
      0%   { transform: scale(0.75) rotate(-4deg); opacity: 0; }
      45%  { transform: scale(1.04) rotate(1deg); opacity: 1; }
      100% { transform: scale(1) rotate(0); }
    }

    #errorMsg {
      margin-top: 4px;
      font-size: 13px;
      color: #e02424;
      display: none;
    }

    #hintMsg {
      margin-top: 6px;
      font-size: 13px;
      color: var(--loy-blue);
      display: none;
      opacity: 0;
      transition: opacity .4s;
    }
  </style>
</head>

<body>
  <div id="header"></div>
  <script>
    loadHeader("ç”Ÿæ´»å·¥å…·", "éš¨æ©Ÿåƒä»€éº¼");
  </script>

  <main>
    <h1>éš¨æ©Ÿåƒä»€éº¼</h1>
    <p>ä¸çŸ¥é“åƒä»€éº¼çš„æ™‚å€™ï¼Œå°±è®“å°æ´›ä¼Šå¹«ä½ æŠ½å‡ºä¸€å¼µã€Œä»Šæ—¥é¤é»å¡ã€å§ï¼</p>

    <div class="layout">

      <!-- å·¦å´ -->
      <section class="loy-card">
        <div class="panel-header">
          <div id="itemCount" class="count-text">ç›®å‰ 0 å€‹é¸é …</div>
          <button id="btnClearList" class="tool-btn secondary">æ¸…ç©ºèœå–®</button>
        </div>

        <textarea id="itemInput" class="loy-textarea"></textarea>

        <label style="font-size:13px;">
          <input type="checkbox" id="chkNoRepeat" checked>
          é¿å…é€£çºŒæŠ½åˆ°ç›¸åŒé¸é …
        </label>

        <div id="errorMsg"></div>
        <div id="hintMsg">é è¨­èœå–®å·²è¼‰å…¥</div>
      </section>

      <!-- å³å´ -->
      <section class="loy-card">
        <div class="panel-header">
          <span>æŠ½å¡çµæœ</span>
          <span style="font-size:12px;color:#aaa;">æŒ‰ã€Œé–‹å§‹æŠ½ã€æˆ–æŒ‰ Space</span>
        </div>

        <div class="draw-card-wrapper">
          <div class="draw-card" id="drawCard">
            <div class="draw-tag">ä»Šæ—¥é¤é»</div>
            <div id="drawEmoji" class="draw-emoji">ğŸ²</div>
            <div id="drawMain" class="draw-main">å°šæœªæŠ½å¡</div>
            <div id="drawSub" class="draw-sub">æº–å‚™å¥½å¾ŒæŒ‰ä¸‹é–‹å§‹æŠ½å§ï¼</div>
          </div>

          <div style="display:flex;gap:8px;margin-top:6px;">
            <button id="btnDraw" class="tool-btn">é–‹å§‹æŠ½</button>
            <button id="btnReDraw" class="tool-btn secondary" disabled>å†æŠ½ä¸€æ¬¡</button>
          </div>

          <div id="drawFooter" class="draw-footer">å°æç¤ºï¼šé£Ÿç‰©åç¨±è·Ÿä¸Šé¢çš„åœ–ç‰‡æ²’æœ‰é—œè¯ï¼</div>
        </div>
      </section>

    </div>
  </main>

  <script>
    const defaultItems = [
      "å°å¼ä¾¿ç•¶","ç‡’è‡˜ä¾¿ç•¶","æ»·è‚‰é£¯","é›è‚‰é£¯","æ’éª¨é£¯","è±¬è…³é£¯","é´¨è‚‰é£¯","æ§è‚‰é£¯","æ²¹é£¯",
      "å°å¼æ—©é¤","éµæ¿éºµ","é‹ç‡’æ„éºµ","é™½æ˜¥éºµ","ç‰›è‚‰éºµ","éº»é†¬éºµ","ä¹¾éºµ","æ¹¯éºµ","æ¦¨èœè‚‰çµ²éºµ","æ“”ä»”éºµ",
      "æ»·å‘³","ç‚’é£¯","è›‹ç‚’é£¯","ç‚’éºµ","ç‚’å†¬ç²‰","èšµä»”éºµç·š","è‚‰ç¾¹","é­·é­šç¾¹","å››ç¥æ¹¯","æ’éª¨é…¥æ¹¯","è²¢ä¸¸æ¹¯",
      "å°ç± åŒ…","æ¹¯åŒ…","ç”Ÿç…åŒ…","æ°´é¤ƒ","é‹è²¼","è”¥æ²¹é¤…","ç‡’é¤…æ²¹æ¢","èƒ¡æ¤’é¤…","è”¥æŠ“é¤…","è›‹é¤…",
      "é¹¹é…¥é›","ç‚¸ç‰©æ‹¼ç›¤","é¹½æ°´é›","é—œæ±ç…®","å°å¼ä¸²ç‡’","æ»·å‘³ï¼ˆç†±æ»·ï¼‰","èšµä»”ç…","å¤§è…¸åŒ…å°è…¸","è‡­è±†è…ï¼ˆç‚¸ï¼‰","è‡­è±†è…ï¼ˆéº»è¾£ï¼‰",
      "ç†±ç‚’","æµ·é®®å¿«ç‚’","ç²¥å“","å»£æ±ç²¥","ç ‚é‹é­šé ­",
      "ç‰›æ’é¤¨","ç¾å¼æ¼¢å ¡","ç¾å¼ç‚¸é›","ç‚¸é­šè–¯æ¢","æŠ«è–©","ç¾©å¤§åˆ©éºµ","ç¾©å¼ç‡‰é£¯","ç„—çƒ¤æ–™ç†","æ³•å¼åå¸","æ—©åˆé¤","ä¸‰æ˜æ²»","æ²™æ‹‰","å¥åº·é¤ç›’",
      "ç´ é£Ÿè‡ªåŠ©é¤","è”¬é£Ÿç¾©å¤§åˆ©éºµ",
      "æ—¥å¼æ‹‰éºµ","æ—¥å¼å’–å“©","ä¸¼é£¯","å£½å¸","æ‰‹å·","æ—¥å¼å®šé£Ÿ","çƒé¾éºµ","å¤©å©¦ç¾…","ç‚¸è±¬æ’","ç« é­šç‡’",
      "éŸ“å¼æ–™ç†","éŸ“å¼ç‚¸é›","éƒ¨éšŠé‹","éŸ“å¼çƒ¤è‚‰","çŸ³é‹æ‹Œé£¯","æ³¡èœé‹","å«©è±†è…é‹","è¾£ç‚’å¹´ç³•","æµ·é®®ç…é¤…","ç´«èœé£¯æ²",
      "æ³°å¼æ–™ç†","è¶Šå—æ²³ç²‰","è¶Šå—æ³•åœ‹éºµåŒ…","å°å°¼æ–™ç†","é¦¬ä¾†æ–™ç†","å°åº¦å’–å“©","æ–°åŠ å¡æ–™ç†",
      "éº»è¾£ç‡™","ç«é‹","ç‡’çƒ¤"
    ];

    const itemInput = document.getElementById("itemInput");
    const itemCount = document.getElementById("itemCount");
    const errorMsg = document.getElementById("errorMsg");
    const hintMsg = document.getElementById("hintMsg");
    const chkNoRepeat = document.getElementById("chkNoRepeat");

    const btnClearList = document.getElementById("btnClearList");
    const btnDraw = document.getElementById("btnDraw");
    const btnReDraw = document.getElementById("btnReDraw");

    const drawCard = document.getElementById("drawCard");
    const drawEmoji = document.getElementById("drawEmoji");
    const drawMain = document.getElementById("drawMain");
    const drawSub = document.getElementById("drawSub");

    let lastChoice = null;

    /* === ä¿®å¾©é€£é»æ°¸å‹•æ©Ÿï¼šå‹•ç•«æ§åˆ¶ === */
    let flashTimer = null;
    let flashToken = 0;
    let isDrawing = false;

    function stopFlash() {
      if (flashTimer) {
        clearInterval(flashTimer);
        flashTimer = null;
      }
    }

    function loadDefault() {
      itemInput.value = defaultItems.join("\n");
      updateCount();
      showHint("é è¨­èœå–®å·²è¼‰å…¥");
    }

    function getItems() {
      return itemInput.value
        .split(/\r?\n/)
        .map(v => v.trim())
        .filter(v => v.length > 0);
    }

    function updateCount() {
      itemCount.textContent = `ç›®å‰ ${getItems().length} å€‹é¸é …`;
    }

    function showHint(msg) {
      hintMsg.textContent = msg;
      hintMsg.style.display = "block";
      hintMsg.style.opacity = "1";
      setTimeout(() => {
        hintMsg.style.opacity = "0";
        setTimeout(() => hintMsg.style.display = "none", 400);
      }, 1200);
    }

    function showError(msg) {
      if (!msg) {
        errorMsg.style.display = "none";
        return;
      }
      errorMsg.textContent = msg;
      errorMsg.style.display = "block";
    }

    /* æŠ½å¡è·‘é¦¬ç‡ˆå‹•ç•«ï¼ˆå¯å–æ¶ˆï¼‰ */
    function startFlash(items, duration = 800) {
      stopFlash();
      const myToken = ++flashToken;

      return new Promise(resolve => {
        let idx = 0;

        flashTimer = setInterval(() => {
          if (myToken !== flashToken) {
            stopFlash();
            return;
          }
          drawMain.textContent = items[idx];
          drawEmoji.textContent = "âœ¨";
          idx = (idx + 1) % items.length;
        }, 70);

        setTimeout(() => {
          if (myToken === flashToken) {
            stopFlash();
            resolve();
          }
        }, duration);
      });
    }

    function pickOne() {
      const items = getItems();
      if (!items.length) return null;

      let choice = items[Math.floor(Math.random() * items.length)];

      if (chkNoRepeat.checked && items.length > 1) {
        let safe = 0;
        while (choice === lastChoice && safe < 8) {
          choice = items[Math.floor(Math.random() * items.length)];
          safe++;
        }
      }

      lastChoice = choice;
      return choice;
    }

    function updateResult(choice) {
      if (!choice) return;

      const emojis = ["ğŸ±","ğŸœ","ğŸ•","ğŸ¥—","ğŸ›","ğŸ”","ğŸ£","ğŸ¥Ÿ","ğŸ²","ğŸŒ¯","ğŸ—","ğŸ¥ª"];
      drawEmoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];

      drawMain.textContent = choice;
      drawSub.textContent = "å°±æ±ºå®šæ˜¯å®ƒäº†ï¼";

      drawCard.classList.remove("animate");
      void drawCard.offsetWidth;
      drawCard.classList.add("animate");
    }

    /* å®‰å…¨æŠ½å¡ï¼šæŠ½å¡æœŸé–“é–æŒ‰éˆ• + é˜²é€£é» */
    async function doDraw() {
      if (isDrawing) return;
      isDrawing = true;

      btnDraw.disabled = true;
      btnReDraw.disabled = true;

      try {
        const items = getItems();
        showError("");

        if (items.length === 0) {
          showError("æ¸…å–®æ˜¯ç©ºçš„ï¼Œè«‹å…ˆè¼¸å…¥æˆ–è¼‰å…¥é è¨­èœå–®ã€‚");
          return;
        }

        await startFlash(items, 900);
        updateResult(pickOne());
      } finally {
        btnDraw.disabled = false;
        btnReDraw.disabled = (lastChoice === null);
        isDrawing = false;
      }
    }

    btnClearList.onclick = () => {
      /* æ¸…ç©ºæ™‚å¼·åˆ¶åœæ‰å‹•ç•« + å–æ¶ˆä»»ä½•æ­£åœ¨è·‘çš„æŠ½å¡ */
      flashToken++;
      stopFlash();

      itemInput.value = "";
      updateCount();
      showError("");

      lastChoice = null;
      btnReDraw.disabled = true;

      drawMain.textContent = "å°šæœªæŠ½å¡";
      drawSub.textContent = "è«‹è¼¸å…¥æ¸…å–®å¾Œå†æŠ½å–ï½";
      drawEmoji.textContent = "ğŸ²";
    };

    btnDraw.onclick = doDraw;
    btnReDraw.onclick = doDraw;

    /* Space å¿«é€ŸæŠ½å¡ */
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space" && !["INPUT","TEXTAREA"].includes(document.activeElement.tagName)) {
        e.preventDefault();
        doDraw();
      }
    });

    itemInput.addEventListener("input", () => {
      updateCount();
      showError("");
    });

    loadDefault();
  </script>

  <div id="global-buttons"></div>

  <style>
    /* åªèª¿æ•´å¤–è§€ï¼Œä¸åŠ  tool-btn ä»¥é¿å…ç ´å£åœ“å½¢ */
    #global-buttons .global-btn {
      background: var(--card-bg) !important;
      border: 1px solid var(--border);
      color: var(--text);
      font-size: 20px !important;
      border-radius: 50% !important;
      width: 48px !important;
      height: 48px !important;
      padding: 0 !important;
    }

    #global-buttons .global-btn:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.20);
      transform: scale(1.08);
    }
  </style>

  <script src="/js/global.js"></script>
  <script src="/js/loyui.js"></script>
</body>
</html>
